unit uFrmObrasFuros;

interface

uses
  Windows, Messages, SysUtils, Variants, Classes, Graphics, Controls, Forms,
  Dialogs, uFrmPadrao, ExtCtrls, SUIButton, SUIDBCtrls, Grids, DBGrids,
  SUIImagePanel, SUIForm, StdCtrls;

type
  TFrmObrasFuros = class(TFrmPadrao)
    Label1: TLabel;
    txtObra: TStaticText;
    Label2: TLabel;
    txtCliente: TStaticText;
    txtID: TLabel;
    procedure btnIncluirClick(Sender: TObject);
    procedure btnAlterarClick(Sender: TObject);
    procedure btnExcluirClick(Sender: TObject);
  private
    { Private declarations }
  public
    { Public declarations }
    procedure chamarTelaEdicao(strOpcao: string);
  end;

var
  FrmObrasFuros: TFrmObrasFuros;

implementation

{$R *.dfm}
uses uDatamodule,uFuncoes, uFrmObrasFurosEdicao;

procedure TFrmObrasFuros.btnIncluirClick(Sender: TObject);
var
   strSQL:string;
   sLastID:string;
begin
  inherited;
  //chamarTelaEdicao('I');
     strSQL:='INSERT INTO zf_furos ('+
            ' idobra ,    '+
            ' iddiametro,    '+
            ' descricaofuro,    '+
            ' cota_sondagem, '+
            ' cota_arrasamento '+
            ' ) VALUES ( '+
            aspas( VirgulaParaPonto(uDatamodule.DataModule1.qryLocal_Obrasid.AsString ))+','+
            aspas( '0') +','+
            aspas( '' ) +','+
            aspas( '0.00' ) +','+
            aspas( '0.00')+' )';

  executarSQL( strSQL );
  uDatamodule.DataModule1.QryLocal_ObrasFuros.Refresh;

  strSQL  :='SELECT COALESCE(MAX(id),0)+1) AS ID FROM zf_furos WHERE idobra='+aspas( VirgulaParaPonto(uDatamodule.DataModule1.qryLocal_Obrasid.AsString ));
  sLastID :=retornarValor( strSQL );
  with DataModule1.QryLocal_ObrasFuros do begin
   first;
   locate('id', sLastID, []);
   chamarTelaEdicao('A');
  end;


end;

procedure TFrmObrasFuros.btnAlterarClick(Sender: TObject);
begin
  inherited;
  chamarTelaEdicao('A')
end;

procedure TFrmObrasFuros.btnExcluirClick(Sender: TObject);
begin
  inherited;
  chamarTelaEdicao('E')
end;

procedure TFrmObrasFuros.chamarTelaEdicao(strOpcao: string);
begin
 //chamar a tela de edição como a opção (I)ncluir, (A)lterar ou (E)xcluir
 if strOpcao<>'I' then begin
  if datamodule1.qrylocal_clientes.RecordCount = 0 then
   begin
      myMSG( 'Tabela Vazia! ','Opção não disponível',2);
      exit;
   end;
 end;

 timer1.Enabled:=false;

 if not assigned(FrmObrasFurosEdicao) then  FrmObrasFurosEdicao:=TFrmObrasFurosEdicao.Create(Application);
                 uFrmObrasFurosEdicao.FrmObrasFurosEdicao.carregarCampos(strOpcao);
                 FrmObrasFurosEdicao.ShowModal;
                  FreeAndNil(FrmObrasFurosEdicao);


 timer1.Enabled:=true;

end;

end.
